# -*- coding: utf-8 -*-
# Copyright (C) 2013 Nurilab.
# Author: Kei Choi(hanul93@gmail.com)

import postfile
import ast
import urllib
import urllib2
import json

VT_KEY     = 'cc9bd463018a4de98c4652c7c433a04b0fa91a8196057db03b0009a515046de7'
HOST       = 'www.virustotal.com'
SCAN_URL   = 'https://www.virustotal.com/vtapi/v2/file/scan'
REPORT_URL = 'https://www.virustotal.com/vtapi/v2/file/report'

## 파일 검사
FILE_PATH = 'D:/Cyphers/CyphersLauncher.exe'

fields = [('apikey', VT_KEY)]
file_to_send = open(FILE_PATH, 'rb').read()
files = [('file', FILE_PATH, file_to_send)]
data = postfile.post_multipart(HOST, SCAN_URL, fields, files)

# 문자열을 해당 데이터 타입으로 변경 (여기에서는 딕셔너리로 변경')
data = ast.literal_eval(data)
resource = data['resource']

## 결과 출력
parameters = {'resource': resource, 'apikey': VT_KEY}
data = urllib.urlencode(parameters)
req = urllib2.Request(REPORT_URL, data)
response = urllib2.urlopen(req)
data = response.read()

data = json.loads(data)
scan = data.get('scans', {})

keys = scan.keys()
for key in keys :
    print('%-20s : %s' % (key, scan[key]['result']))